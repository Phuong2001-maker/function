/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/gifenc@1.0.3/dist/gifenc.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __defProp=Object.defineProperty,__markAsModule=e=>__defProp(e,"__esModule",{value:!0}),__export=(e,t)=>{for(var r in t)__defProp(e,r,{get:t[r],enumerable:!0})};__markAsModule(exports),__export(exports,{GIFEncoder:()=>GIFEncoder,applyPalette:()=>applyPalette,default:()=>src_default,nearestColor:()=>nearestColor,nearestColorIndex:()=>nearestColorIndex,nearestColorIndexWithDistance:()=>nearestColorIndexWithDistance,prequantize:()=>prequantize,quantize:()=>quantize,snapColorsToPalette:()=>snapColorsToPalette});var constants_default={signature:"GIF",version:"89a",trailer:59,extensionIntroducer:33,applicationExtensionLabel:255,graphicControlExtensionLabel:249,imageSeparator:44,signatureSize:3,versionSize:3,globalColorTableFlagMask:128,colorResolutionMask:112,sortFlagMask:8,globalColorTableSizeMask:7,applicationIdentifierSize:8,applicationAuthCodeSize:3,disposalMethodMask:28,userInputFlagMask:2,transparentColorFlagMask:1,localColorTableFlagMask:128,interlaceFlagMask:64,idSortFlagMask:32,localColorTableSizeMask:7};function createStream(e=256){let t=0,r=new Uint8Array(e);return{get buffer(){return r.buffer},reset(){t=0},bytesView:()=>r.subarray(0,t),bytes:()=>r.slice(0,t),writeByte(e){n(t+1),r[t]=e,t++},writeBytes(e,o=0,a=e.length){n(t+a);for(let n=0;n<a;n++)r[t++]=e[n+o]},writeBytesView(e,o=0,a=e.byteLength){n(t+a),r.set(e.subarray(o,o+a),t),t+=a}};function n(e){var n=r.length;if(n>=e)return;e=Math.max(e,n*(n<1048576?2:1.125)>>>0),0!=n&&(e=Math.max(e,256));const o=r;r=new Uint8Array(e),t>0&&r.set(o.subarray(0,t),0)}}var BITS=12,DEFAULT_HSIZE=5003,MASKS=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function lzwEncode(e,t,r,n,o=createStream(512),a=new Uint8Array(256),i=new Int32Array(DEFAULT_HSIZE),c=new Int32Array(DEFAULT_HSIZE)){const l=i.length,s=Math.max(2,n);a.fill(0),c.fill(0),i.fill(-1);let f=0,u=0;const w=s+1,d=w;let b=!1,g=d,y=(1<<g)-1;const p=1<<w-1,h=p+1;let B=p+2,_=0,m=r[0],I=0;for(let e=l;e<65536;e*=2)++I;I=8-I,o.writeByte(s),S(p);const A=r.length;for(let e=1;e<A;e++)e:{const t=r[e],n=(t<<BITS)+m;let o=t<<I^m;if(i[o]===n){m=c[o];break e}const a=0===o?1:l-o;for(;i[o]>=0;)if(o-=a,o<0&&(o+=l),i[o]===n){m=c[o];break e}S(m),m=t,B<1<<BITS?(c[o]=B++,i[o]=n):(i.fill(-1),B=p+2,b=!0,S(p))}return S(m),S(h),o.writeByte(0),o.bytesView();function S(e){for(f&=MASKS[u],u>0?f|=e<<u:f=e,u+=g;u>=8;)a[_++]=255&f,_>=254&&(o.writeByte(_),o.writeBytesView(a,0,_),_=0),f>>=8,u-=8;if((B>y||b)&&(b?(g=d,y=(1<<g)-1,b=!1):(++g,y=g===BITS?1<<g:(1<<g)-1)),e==h){for(;u>0;)a[_++]=255&f,_>=254&&(o.writeByte(_),o.writeBytesView(a,0,_),_=0),f>>=8,u-=8;_>0&&(o.writeByte(_),o.writeBytesView(a,0,_),_=0)}}}var lzwEncode_default=lzwEncode;function rgb888_to_rgb565(e,t,r){return e<<8&63488|t<<2&992|r>>3}function rgba8888_to_rgba4444(e,t,r,n){return e>>4|240&t|(240&r)<<4|(240&n)<<8}function rgb888_to_rgb444(e,t,r){return e>>4<<8|240&t|r>>4}function clamp(e,t,r){return e<t?t:e>r?r:e}function sqr(e){return e*e}function find_nn(e,t,r){var n=0,o=1e100;const a=e[t],i=a.cnt,c=a.ac,l=a.rc,s=a.gc,f=a.bc;for(var u=a.fw;0!=u;u=e[u].fw){const t=e[u],a=t.cnt,d=i*a/(i+a);if(!(d>=o)){var w=0;r&&(w+=d*sqr(t.ac-c))>=o||(w+=d*sqr(t.rc-l))>=o||(w+=d*sqr(t.gc-s))>=o||(w+=d*sqr(t.bc-f))>=o||(o=w,n=u)}}a.err=o,a.nn=n}function create_bin(){return{ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0}}function create_bin_list(e,t){const r=new Array("rgb444"===t?4096:65536),n=e.length;if("rgba4444"===t)for(let t=0;t<n;++t){const n=e[t],o=n>>24&255,a=n>>16&255,i=n>>8&255,c=255&n,l=rgba8888_to_rgba4444(c,i,a,o);let s=l in r?r[l]:r[l]=create_bin();s.rc+=c,s.gc+=i,s.bc+=a,s.ac+=o,s.cnt++}else if("rgb444"===t)for(let t=0;t<n;++t){const n=e[t],o=n>>16&255,a=n>>8&255,i=255&n,c=rgb888_to_rgb444(i,a,o);let l=c in r?r[c]:r[c]=create_bin();l.rc+=i,l.gc+=a,l.bc+=o,l.cnt++}else for(let t=0;t<n;++t){const n=e[t],o=n>>16&255,a=n>>8&255,i=255&n,c=rgb888_to_rgb565(i,a,o);let l=c in r?r[c]:r[c]=create_bin();l.rc+=i,l.gc+=a,l.bc+=o,l.cnt++}return r}function quantize(e,t,r={}){const{format:n="rgb565",clearAlpha:o=!0,clearAlphaColor:a=0,clearAlphaThreshold:i=0,oneBitAlpha:c=!1}=r;if(!e||!e.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");const l=new Uint32Array(e.buffer);let s=!1!==r.useSqrt;const f="rgba4444"===n,u=create_bin_list(l,n),w=u.length,d=w-1,b=new Uint32Array(w+1);for(var g=0,y=0;y<w;++y){const e=u[y];if(null!=e){var p=1/e.cnt;f&&(e.ac*=p),e.rc*=p,e.gc*=p,e.bc*=p,u[g++]=e}}sqr(t)/g<.022&&(s=!1);var h,B,_;for(y=0;y<g-1;++y)u[y].fw=y+1,u[y+1].bk=y,s&&(u[y].cnt=Math.sqrt(u[y].cnt));for(s&&(u[y].cnt=Math.sqrt(u[y].cnt)),y=0;y<g;++y){find_nn(u,y,!1);var m=u[y].err;for(B=++b[0];B>1&&!(u[h=b[_=B>>1]].err<=m);B=_)b[B]=h;b[B]=y}var I=g-t;for(y=0;y<I;){for(var A;;){var S=b[1];if((A=u[S]).tm>=A.mtm&&u[A.nn].mtm<=A.tm)break;A.mtm==d?S=b[1]=b[b[0]--]:(find_nn(u,S,!1),A.tm=y);m=u[S].err;for(B=1;(_=B+B)<=b[0]&&(_<b[0]&&u[b[_]].err>u[b[_+1]].err&&_++,!(m<=u[h=b[_]].err));B=_)b[B]=h;b[B]=S}var x=u[A.nn],C=A.cnt,M=x.cnt;p=1/(C+M);f&&(A.ac=p*(C*A.ac+M*x.ac)),A.rc=p*(C*A.rc+M*x.rc),A.gc=p*(C*A.gc+M*x.gc),A.bc=p*(C*A.bc+M*x.bc),A.cnt+=x.cnt,A.mtm=++y,u[x.bk].fw=x.fw,u[x.fw].bk=x.bk,x.mtm=d}let q=[];var U=0;for(y=0;;++U){let e=clamp(Math.round(u[y].rc),0,255),t=clamp(Math.round(u[y].gc),0,255),r=clamp(Math.round(u[y].bc),0,255),n=255;if(f){if(n=clamp(Math.round(u[y].ac),0,255),c){n=n<=("number"==typeof c?c:127)?0:255}o&&n<=i&&(e=t=r=a,n=0)}const l=f?[e,t,r,n]:[e,t,r];if(existsInPalette(q,l)||q.push(l),0==(y=u[y].fw))break}return q}function existsInPalette(e,t){for(let r=0;r<e.length;r++){const n=e[r];let o=n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2],a=!(n.length>=4&&t.length>=4)||n[3]===t[3];if(o&&a)return!0}return!1}function euclideanDistanceSquared(e,t){var r,n=0;for(r=0;r<e.length;r++){const o=e[r]-t[r];n+=o*o}return n}function roundStep(e,t){return t>1?Math.round(e/t)*t:e}function prequantize(e,{roundRGB:t=5,roundAlpha:r=10,oneBitAlpha:n=null}={}){const o=new Uint32Array(e.buffer);for(let e=0;e<o.length;e++){const a=o[e];let i=a>>24&255,c=a>>16&255,l=a>>8&255,s=255&a;if(i=roundStep(i,r),n){i=i<=("number"==typeof n?n:127)?0:255}s=roundStep(s,t),l=roundStep(l,t),c=roundStep(c,t),o[e]=i<<24|c<<16|l<<8|s}}function applyPalette(e,t,r="rgb565"){if(!e||!e.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");if(t.length>256)throw new Error("applyPalette() only works with 256 colors or less");const n=new Uint32Array(e.buffer),o=n.length,a="rgb444"===r?4096:65536,i=new Uint8Array(o),c=new Array(a);if("rgba4444"===r)for(let e=0;e<o;e++){const r=n[e],o=r>>24&255,a=r>>16&255,l=r>>8&255,s=255&r,f=rgba8888_to_rgba4444(s,l,a,o),u=f in c?c[f]:c[f]=nearestColorIndexRGBA(s,l,a,o,t);i[e]=u}else{const e="rgb444"===r?rgb888_to_rgb444:rgb888_to_rgb565;for(let r=0;r<o;r++){const o=n[r],a=o>>16&255,l=o>>8&255,s=255&o,f=e(s,l,a),u=f in c?c[f]:c[f]=nearestColorIndexRGB(s,l,a,t);i[r]=u}}return i}function nearestColorIndexRGBA(e,t,r,n,o){let a=0,i=1e100;for(let c=0;c<o.length;c++){const l=o[c];let s=sqr2(l[3]-n);if(s>i)continue;if(s+=sqr2(l[0]-e),s>i)continue;if(s+=sqr2(l[1]-t),s>i)continue;s+=sqr2(l[2]-r),s>i||(i=s,a=c)}return a}function nearestColorIndexRGB(e,t,r,n){let o=0,a=1e100;for(let i=0;i<n.length;i++){const c=n[i];let l=sqr2(c[0]-e);if(l>a)continue;if(l+=sqr2(c[1]-t),l>a)continue;l+=sqr2(c[2]-r),l>a||(a=l,o=i)}return o}function snapColorsToPalette(e,t,r=5){if(!e.length||!t.length)return;const n=e.map((e=>e.slice(0,3))),o=r*r,a=e[0].length;for(let r=0;r<t.length;r++){let i=t[r];i=i.length<a?[i[0],i[1],i[2],255]:i.length>a?i.slice(0,3):i.slice();const c=nearestColorIndexWithDistance(n,i.slice(0,3),euclideanDistanceSquared),l=c[0],s=c[1];s>0&&s<=o&&(e[l]=i)}}function sqr2(e){return e*e}function nearestColorIndex(e,t,r=euclideanDistanceSquared){let n=1/0,o=-1;for(let a=0;a<e.length;a++){const i=r(t,e[a]);i<n&&(n=i,o=a)}return o}function nearestColorIndexWithDistance(e,t,r=euclideanDistanceSquared){let n=1/0,o=-1;for(let a=0;a<e.length;a++){const i=r(t,e[a]);i<n&&(n=i,o=a)}return[o,n]}function nearestColor(e,t,r=euclideanDistanceSquared){return e[nearestColorIndex(e,t,r)]}function GIFEncoder(e={}){const{initialCapacity:t=4096,auto:r=!0}=e,n=createStream(t),o=new Uint8Array(256),a=new Int32Array(5003),i=new Int32Array(5003);let c=!1;return{reset(){n.reset(),c=!1},finish(){n.writeByte(constants_default.trailer)},bytes:()=>n.bytes(),bytesView:()=>n.bytesView(),get buffer(){return n.buffer},get stream(){return n},writeHeader:l,writeFrame(e,t,s,f={}){const{transparent:u=!1,transparentIndex:w=0,delay:d=0,palette:b=null,repeat:g=0,colorDepth:y=8,dispose:p=-1}=f;let h=!1;if(r?c||(h=!0,l(),c=!0):h=Boolean(f.first),t=Math.max(0,Math.floor(t)),s=Math.max(0,Math.floor(s)),h){if(!b)throw new Error("First frame must include a { palette } option");encodeLogicalScreenDescriptor(n,t,s,b,y),encodeColorTable(n,b),g>=0&&encodeNetscapeExt(n,g)}const B=Math.round(d/10);encodeGraphicControlExt(n,p,B,u,w);const _=Boolean(b)&&!h;encodeImageDescriptor(n,t,s,_?b:null),_&&encodeColorTable(n,b),encodePixels(n,e,t,s,y,o,a,i)}};function l(){writeUTFBytes(n,"GIF89a")}}function encodeGraphicControlExt(e,t,r,n,o){var a,i;e.writeByte(33),e.writeByte(249),e.writeByte(4),o<0&&(o=0,n=!1),n?(a=1,i=2):(a=0,i=0),t>=0&&(i=7&t),i<<=2;e.writeByte(i|a),writeUInt16(e,r),e.writeByte(o||0),e.writeByte(0)}function encodeLogicalScreenDescriptor(e,t,r,n,o=8){const a=128|o-1<<4|colorTableSize(n.length)-1;writeUInt16(e,t),writeUInt16(e,r),e.writeBytes([a,0,0])}function encodeNetscapeExt(e,t){e.writeByte(33),e.writeByte(255),e.writeByte(11),writeUTFBytes(e,"NETSCAPE2.0"),e.writeByte(3),e.writeByte(1),writeUInt16(e,t),e.writeByte(0)}function encodeColorTable(e,t){const r=1<<colorTableSize(t.length);for(let n=0;n<r;n++){let r=[0,0,0];n<t.length&&(r=t[n]),e.writeByte(r[0]),e.writeByte(r[1]),e.writeByte(r[2])}}function encodeImageDescriptor(e,t,r,n){if(e.writeByte(44),writeUInt16(e,0),writeUInt16(e,0),writeUInt16(e,t),writeUInt16(e,r),n){const t=0,r=0,o=colorTableSize(n.length)-1;e.writeByte(128|t|r|o)}else e.writeByte(0)}function encodePixels(e,t,r,n,o=8,a,i,c){lzwEncode_default(r,n,t,o,e,a,i,c)}function writeUInt16(e,t){e.writeByte(255&t),e.writeByte(t>>8&255)}function writeUTFBytes(e,t){for(var r=0;r<t.length;r++)e.writeByte(t.charCodeAt(r))}function colorTableSize(e){return Math.max(Math.ceil(Math.log2(e)),1)}var src_default=GIFEncoder;
//# sourceMappingURL=/sm/5590bec8c781f75f71e4bc269a81f05c96ef356f967ea7a7deadf384c62bffeb.map